# Naruhodo(なるほど)

[![Build Status](https://travis-ci.org/superkerokero/naruhodo.svg?branch=master)](https://travis-ci.org/superkerokero/naruhodo)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![PyPI version](https://badge.fury.io/py/naruhodo.svg)](https://badge.fury.io/py/naruhodo)

[English version](README.md)

`naruhodo`は英語・日本語テキスト、もしくは英語・日本語テキストを含むWebページから依存構造グラフ（DSG）と知識構造グラフ（KSG）を生成するためのPythonライブラリーです。Notebook内で直接可視化が可能で、JSONファィルに出力して外部プログラムに使わせる事も可能です。

### 依存構造グラフ（DSG）

[依存構造解析](https://web.stanford.edu/~jurafsky/slp3/14.pdf)とは、 コンピュータプログラムで[依存文法](https://en.wikipedia.org/wiki/Dependency_grammar)に沿ってテキスト解析する事です。
依存構造は有向グラフで表す事ができます。この有向グラフを依存構造グラフ（DSG）と呼びます。

あるテキストが持つ文法的依存構造に加え、形態素解析で得られた各文節の構成や変形の情報もあれば、コンピューターにこのテキストが含む情報をある程度理解できるようになります。自然言語解析（NLP）はある意味、コンピュターが人間の代わりに有効な情報を生データから吸収（再加工）する事です。そうなれば人間は知りたい情報だけをコンピュターから聞けば良いので、情報処理の効率を高める事ができる。こういう意味では、依存情報グラフ自体はまだ人間にとってもコンピュターにとっても実用的な価値は薄い。ただ有向グラフとして可視化する事はそれなりに面白いし、可視化である程度元のテキストの構造やキーワードがわかります。後述の情報構造グラフ（KSG）はDSGを元に作られています。

`naruhodo`は依存構造解析プログラムの出力を直接読み込んでDSGを生成します。 

この図は下記のテキストで生成されたDSGです。

```
"一郎は二郎が描いた絵を三郎に贈った。"
"三郎はこの絵を持って市場に行った。"
"市場には人が一杯だ。"
```

![DSG generated from texts](img/DSG_example.png)

### 知識構造グラフ（KSG）

DSGと違って、知識構造グラフ（KSG）がキャプチャーしようとするのは実体の間の意味のある関係です。KSGはある種の汎用知識ベースの有向グラフ表示として考えられます。KSGは外部の構造解析プログラムの出力に基づいて生成されます。

KSGには主に二種類のノードがあります：
* 特定の実体を表す実体ノード（殆どが名詞か名詞として使われるもの）
* ある種の性質・アクションを表す性質・アクションノード（殆どが形容詞か動詞）

実体ノードは性質・アクションノードで繋がれます。エッジはノード間の繋がりを表せます。もし実体に何か性質を持っている、もしくは何かアクションを取っていたのであれば、この実体ノードから対応の性質・アクションノードにエッジが指します。もし実体ノードはある種の性質の要素として存在する、もしくは何かアクションの対象になっている場合、対応の性質・アクションノードからこの実体ノードにエッジが指します。

このようなグラフ構造は人の脳のなかの情報・知識の在り方にかなり近いと思います。`naruhoko`のKSG解析の目標は人間が読めるテキストから自動的にできるだけ正確・完全なグラフ構造を生成する事です。

KSGで使えるメソッドはDSGとほぼ同じです。

この図は下記のテキストで生成されたKSGです。

```
"一郎は二郎が描いた絵を三郎に贈った。"
"三郎はこの絵を持って市場に行った。"
"市場には人がいっぱいだ。"
```

![KSG generated from texts](img/KSG_example.png)

## インストール

`naruhodo`は`python`バージョン 3.4 以降をサポートします。

`pip` で簡単にインストールできます:

```bash
pip install naruhodo
```

この方法は`naruhodo`のリリースバージョンをインストールします。 
開発中のバージョンは以下のコマンドで github から直接インストールできます:

```bash
pip install https://github.com/superkerokero/naruhodo/archive/dev.zip
``` 

`naruhodo`は外部プログラムで形態素解析と依存構造解析を行います。故にNaruhodoをつかうためには、対応している外部プログラムをインストールする事も必要です。

`naruhodo`は複数のバックエンドプログラムに対応できるように設計されていますが、今は　`mecab` + `cabocha` のみをサポートしています。

`mecab` と `cabocha` のインストールについては、この記事を参照してください：

[Amazon Linux に MeCab と CaboCha をインストール](https://qiita.com/january108/items/85c80769ea870c190eaa)

他のバックエンドプログラム（`KNP` など）へのサポートはこれから追加する予定です。

## チュートリアル

`naruhodo`のチュートリアルはリポジトリの`tutorial`フォルダに`ipynb` ファィルとして用意されています。ブラウザから直接閲覧する事も可能です。このチュートリアルには Naruhodo の主な機能が紹介されています。

[日本語チュートリアルのノートブック](https://github.com/superkerokero/naruhodo/blob/master/tutorial/Tutorial-Ja.ipynb)

## Python-API

Python API ドキュメントはここ:

[`naruhodo` Python API Reference](https://superkerokero.github.io/naruhodo).

このドキュメントは [pdoc](https://github.com/BurntSushi/pdoc)を使って自動的にソースコードから生成されるので、常に最新のデータに更新されています。

## Change-Log

* 0.2.0
  * Major API change for multi-language support and parallel processing. 
  * Parallel processing support for parsing using multiprocess module. 
* 0.1.0
  * Initial version

## 開発状況とコメント

`naruhodo` はまだ開発の途中（特にKSG部分）なので、時々おかしなリザルトを返す事があると予想されます。

もしあなたも `naruhodo` のアイデアが気に入って、開発に協力したいと思うなら、Githubでプルリクエストをしてください。

以下は `naruhodo` の開発についてのコメント:

* ### 生成されたグラフの質向上 (0.2 ~ 0.5)
    
    
    ソースコードからわかるように、`naruhodo`はルールベースのシステムに依存して、与えられた情報を解析します。そして言語のような複雑かつ大規模な問題に対して実用に耐えるものを作るには、長期的なテストと継続的な改善が必要です。

    現在、`naruhodo`によって生成された知識構造グラフ（KSG）は、大量の入力テキストに対しての解析効果はまだ良くない。改良は、入力テキストの多様性とそれに対応する構文解析ロジックの洗練化から来るでしょう。

    ルールベースのシステムは基本、限界があります。ただ、私はNLPの領域で、特に基本的な情報解析タスクでは、ルールベースのシステムも実用的なアプリケーションが作れると信じています。ディープ・ラーニングのような統計学ベースの手法の最近の進歩は有望視されている。しかし、これらの技術のほとんどが、大量のラベル付きデータを必要とします。ここで取られたルールベースのアプローチは、NLPのAb Initio方法として考えられます（有用な予測を行う前にトレーニングデータを必要としません）。このようなアプリケーションは、退屈な作業の一部を自動化することによって、大量のラベル付きデータを収集するという苦痛を少なくとも軽減することができる事が出来れば良いと思います。 `naruhodo`は、NLPの世界でのルールベースのシステムの限界に関する私の個人的な実験でもあります。最終的には役に立たないかもしれませんが、興味深い旅になると確信しています。

* ### さらに多くのバックエンドをサポート (0.5 ~)
    
    インターネット上では、日本語向けの構造解析プログラムはまだ多くありません。 `mecab` +` cabocha`のほかに、最も使いやすい構文解析プログラムは `juman（++）` + `knp`くらいです。 `knp`の出力フォーマットには余分な有用な情報が含まれており、場合によっては`cabocha`よりも正確である可能性があります。しかし、その出力には統一されたスキームがなく、使いにくいものになっています。もう一つの重要な事実は、 `juman（++）` + `knp`の解析は` mecab` + `cabocha`に比べて非常に時間がかかることです。

    私は`spaCy`のようないくつかの高速汎用ライブラリを探しています。日本語は現時点で正式にサポートされている言語ではありませんが、かなり期待できると思います。

    要約すると、`naruhodo`は複数のバックエンドをサポートするように設計されていますが、現在のフォーカスは日本語のみであるため、他のバックエンドのサポートを追加することは優先事項ではありません。

* ### 他の言語へのサポート(?~)
    
    `naruhodo`が今サポートしている言語は、日本語だけです。日本語を選んだのです。それは私の個人的な関心の他に、日本語は挑戦的で報われるという独特の特徴を持っているからです。私の理解では、日本語に関する難しさは、表現があいまいであること（例えば、主題が頻繁に日本語で省略されることが多い）や大量の単語変換（同じ動詞が10+以上の形を持つことができる）から生じます。

    実用的な観点からは、英語や中国語などの言語は潜在的に大きな需要がある。したがって、`naruhodo`のルールベースのアプローチが後で使用可能であることが判明すれば、将来、これらの一般的な言語にライブラリを拡張することを考えています。

* ### 統計的手法を入れる(?~)
    
    最近、皆さんは機械学習に興奮しているようです。私も強化学習や生成的な敵対的なモデルのような技術で、大きなアプリケーションの可能性を見ています。そして、私は、これらのテクニックのいくつかの特定の知識検索の問題への応用についていくつかの考えを持っています。たとえば共参照解析はルールベースのシステムの範囲外であることは明らかであり、この場合、強化学習ベースのアプローチは非常に魅力的です（ユーザーからのリアルタイムのフィードバックシステムがあれば）。
    
    機械学習技術の理解が向上するにつれて、統計ベースのアプローチが将来追加される可能性があります。

* ### 共参照解析機能 (0.5 ~)

    [共参照解析](https://en.wikipedia.org/wiki/Coreference)は、テキスト内の同じエンティティを参照するすべての表現を見つけるタスクです。 適切な共参照解決がなければ、生成されたKSGはすべての意味のある情報を取得するわけではなく、そのユーザビリティはかなり制限されます。共参照解決が実装されていない事が「長文に対しての解析効果はまだ良くない」と言っている最も重要な理由の1つである。
    
    私はこのトピックに関するいくつかの論文を調べています。単語の埋め込みに基づくメソッドは、バージョン0.5〜から`naruhodo`に追加される予定です。

* ### 生成されたグラフの具体的応用(new projects)
    
    依存構造グラフや知識構造グラフは構造化した情報の自動取得・保存・管理で役に立ちます。 具体的な応用例として： 
    * 要約の自動生成
    * 問答システム・翻訳システムのためのデータベース構築
    * 特定の実体に関する感情分析

    KSGの質が満足できるようになれば、私はこれらの応用にも挑戦して見たいと思います。

